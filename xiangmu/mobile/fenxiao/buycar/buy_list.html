<!-- 购物车列表 -->
<!-- 店铺设置 -->
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<title>群飞商贸</title>
	<link rel="stylesheet" href="../skin/mui/css/mui.min.css"/>
	<link rel="stylesheet" href="../skin/fonts/style.css" />
	<link rel="stylesheet" href="../skin/css/public.css" />

	<link rel="stylesheet" href="../skin/css/style.css" />
	<link rel="stylesheet" href="../skin/css/md/md.css" />
</head>
<style type="text/css">
.mui-table-view.mui-grid-view .mui-table-view-cell{
  background-color: #fff;
  color: #ff9900;
}

</style>
<body>
<header id="header" class="mui-bar mui-bar-nav bsd-no">
  <a onclick="history.go(-1);" class="mui-icon mui-icon-left-nav mui-pull-left"></a>
	<div class="mui-title">购物车</div>
</header>
<div class="su-bar-tab su-buy-box">
	<a class="box-center su-buy-true" id="su-buy-true">确认下单</a>
	<span class="su-buy-car" id="buy_end"><i class="icon-iconfont-cart tx-f ft-24"></i>
	<!-- 购物车数量显示  class加show　表示显示-->
		<span id="buyCar-num" data-num="0" class="mall-buy-num su-buy-num">1</span>
	</span>
	<span class="mui-tab-item ct-bar bd-r pd-lr-10 mg-r-10">
		￥<span id="buyCar-money" data-num="0" >0</span>
	</span>
	<span class="mui-tab-item ft-12">优惠￥30
	</span>
</div>
<div class="mui-content">
<ul class="mui-table-view a-href mg-t-10">
	<li class="mui-table-view-cell">
		<a class="mui-navigate-right" href="../mendian/md_massage.html">
			<span class="tx-9 flt-r ft-12">进入店铺</span>
			<div class="mui-ellipsis ft-14">峰哥的淘宝店</div>
		</a>
	</li>
	<li class="mui-table-view-cell">
		<a>
			<img class="mui-media-object mui-pull-left" src="../skin/images/gds03.jpg">
			<div class="mui-media-body">
				<div class="mui-ellipsis ft-14">原味椰子汁</div>
				<p class="mui-ellipsis ft-10"><span class="su-ser-score mg-r-sm">
					<i class="mui-icon mui-icon-star-filled"></i>
					<i class="mui-icon mui-icon-star-filled"></i>
					<i class="mui-icon mui-icon-star-filled"></i>
					<i class="mui-icon mui-icon-star"></i>
					<i class="mui-icon mui-icon-star"></i>
					</span><b class=" tx-f30">4.2</b>
					<span>3评论</span>
					<span>月售265单</span>
				</p>
				<div class="mg-tb-sm pst-r pd-t-sm">
					<!-- type值和侧边的类型id对应 -->
					<div class="su-buybtn-box flt-r " data-uid="shang_1" data-money="11">
						<span class="mui-icon mui-icon-minus su-buy-del"></span>
						<span class="su-buy-body" data-num="0">0</span>
						<span class="mui-icon mui-icon-plus-filled su-buy-add"></span>
					</div>
					<div class="overhid tx-f30">
						<span class="ft-10">￥</span><b>11</b>
					</div>
				</div>
			</div>
		</a>
	</li>
	<li class="mui-table-view-cell">
		<a>
			<img class="mui-media-object mui-pull-left" src="../skin/images/gds01.jpg">
			<div class="mui-media-body">
				<div class="mui-ellipsis ft-14">珍爱巧克力</div>
				<p class="mui-ellipsis ft-10"><span class="su-ser-score mg-r-sm">
					<i class="mui-icon mui-icon-star-filled"></i>
					<i class="mui-icon mui-icon-star-filled"></i>
					<i class="mui-icon mui-icon-star-filled"></i>
					<i class="mui-icon mui-icon-star"></i>
					<i class="mui-icon mui-icon-star"></i>
					</span><b class=" tx-f30">4.2</b>
					<span>3评论</span>
					<span>月售265单</span>
				</p>
				<div class="mg-tb-sm pst-r pd-t-sm">
					<!-- type值和侧边的类型id对应 -->
					<div class="su-buybtn-box flt-r " data-uid="shang_2" data-money="18">
						<span class="mui-icon mui-icon-minus su-buy-del"></span>
						<span class="su-buy-body" data-num="0">0</span>
						<span class="mui-icon mui-icon-plus-filled su-buy-add"></span>
					</div>
					<div class="overhid tx-f30">
						<span class="ft-10">￥</span><b>18</b>
					</div>
				</div>
			</div>
		</a>
	</li>
</ul>

<ul class="mui-table-view a-href mg-t-10">
	<li class="mui-table-view-cell">
		<a class="mui-navigate-right" href="../mendian/md_massage.html">
			<span class="tx-9 flt-r ft-12">进入店铺</span>
			<div class="mui-ellipsis ft-14">压力锅的零食店</div>
		</a>
	</li>
	<li class="mui-table-view-cell">
		<a>
			<img class="mui-media-object mui-pull-left" src="../skin/images/gds04.jpg">
			<div class="mui-media-body">
				<div class="mui-ellipsis ft-14">香脆糖果</div>
				<p class="mui-ellipsis ft-10"><span class="su-ser-score mg-r-sm">
					<i class="mui-icon mui-icon-star-filled"></i>
					<i class="mui-icon mui-icon-star-filled"></i>
					<i class="mui-icon mui-icon-star-filled"></i>
					<i class="mui-icon mui-icon-star"></i>
					<i class="mui-icon mui-icon-star"></i>
					</span><b class=" tx-f30">4.2</b>
					<span>3评论</span>
					<span>月售265单</span>
				</p>
				<div class="mg-tb-sm pst-r pd-t-sm">
					<!-- type值和侧边的类型id对应 -->
					<div class="su-buybtn-box flt-r " data-uid="shang_3" data-money="14">
						<span class="mui-icon mui-icon-minus su-buy-del"></span>
						<span class="su-buy-body" data-num="0">0</span>
						<span class="mui-icon mui-icon-plus-filled su-buy-add"></span>
					</div>
					<div class="overhid tx-f30">
						<span class="ft-10">￥</span><b>14</b>
					</div>
				</div>
			</div>
		</a>
	</li>
	<li class="mui-table-view-cell">
		<a>
			<img class="mui-media-object mui-pull-left" src="../skin/images/gds02.jpg">
			<div class="mui-media-body">
				<div class="mui-ellipsis ft-14">甜心椰子糕</div>
				<p class="mui-ellipsis ft-10"><span class="su-ser-score mg-r-sm">
					<i class="mui-icon mui-icon-star-filled"></i>
					<i class="mui-icon mui-icon-star-filled"></i>
					<i class="mui-icon mui-icon-star-filled"></i>
					<i class="mui-icon mui-icon-star"></i>
					<i class="mui-icon mui-icon-star"></i>
					</span><b class=" tx-f30">4.2</b>
					<span>3评论</span>
					<span>月售265单</span>
				</p>
				<div class="mg-tb-sm pst-r pd-t-sm">
					<!-- type值和侧边的类型id对应 -->
					<div class="su-buybtn-box flt-r " data-uid="shang_4" data-money="22">
						<span class="mui-icon mui-icon-minus su-buy-del"></span>
						<span class="su-buy-body" data-num="0">0</span>
						<span class="mui-icon mui-icon-plus-filled su-buy-add"></span>
					</div>
					<div class="overhid tx-f30">
						<span class="ft-10">￥</span><b>22</b>
					</div>
				</div>
			</div>
		</a>
	</li>
</ul>
</div>

</body>
<script src="../skin/mui/js/mui.min.js"></script>
<script src="../skin/js/jquery-2.1.1.min.js"></script>
<script src="../skin/js/public/super.js"></script>

<script src="../skin/js/public/jquery.fly.min.js"></script>
<script src="../skin/js/plug/layer.m/layer.m.js"></script>
<script type="text/javascript">
;(function($){
var value = [];
	$('body').on('tap','.su-buy-add',function(event){
		var self = jQuery(this);
				startTop = self.offset().top - jQuery('body').scrollTop(),

				offset = jQuery('#buy_end').offset(),
				flyer = jQuery('<span class="u-flyer">1</span>'),
				endTop = offset.top - jQuery('body').scrollTop();

		buyAdd(self,true);

			flyer.fly({
			    start: {
			        left: self.offset().left,
			        top: startTop
			    },
			    end: {
			        left: offset.left,
			        top: endTop,
			        width: 20,
			        height: 20
			    },
			    onEnd:function(){
		        this.destory();
			    }
			});
	})
    $('body').on('tap','.su-buy-del',function(e) {
  		var self = jQuery(this);
  		buyAdd(self,false);
    });



	function buyAdd(self,opt){
		// 购物车的盒子
		var buyBox = jQuery('#buyCar-num'),
				dataNum = buyBox.attr('data-num'),
				moneyBox = jQuery('#buyCar-money'),
				moneyNum = moneyBox.attr('data-num'),


		// 点击的商品类型		
				btnBox = self.closest('.su-buybtn-box'),
				type = btnBox.attr('data-type'),
				money = btnBox.attr('data-money'),
				uid = btnBox.attr('data-uid'),

		// 加减按钮中间的数量
				selBox = self.siblings('.su-buy-body'),
				selNum = selBox.attr('data-num'),
				delBox = self.hasClass('su-buy-del') ? self : self.siblings('.su-buy-del'),

				addBuy = function(box,num){
					!box.is(':hidden') || box.addClass('show');
					
					num = !isNaN(parseInt(num)) ? parseInt(num) + 1 :0;
					box.text(num).attr('data-num',num);

					return num;
				},

				subBuy = function(box,num){
					num = !isNaN(parseInt(num)) ? parseInt(num) - 1 :0;
					box.text(num).attr('data-num',num);
					num == 0 && box.removeClass('show');

					return num;
				},

				eachNum = function(id,num,opt){
					//用关联数组的方式 将对象的键名 用变量改变
					var aa = id,
							thisValue = {};
							thisValue[aa] = num,

							yan = false,
							inx = 0;
							thisValue[id] = num;
					
					jQuery.each(value,function(index, el) {
						jQuery.each(el,function(i,item){
							if(i == id){
								yan = true;
								inx = index;
								return false;
							}
						});
						if(yan){
							return false
						}
					});
					// console.log(thisValue,yan,inx)
					if(opt){
						if(yan){
							value.splice(inx,1,thisValue);
						}else{
							value.push(thisValue)
						}
					}else{
						num != 0 ? value.splice(inx,1,thisValue) : value.splice(inx,1);
						
					}
				}
		



		money = !isNaN(Number(money)) ? Number(money):0;
		moneyNum = !isNaN(Number(moneyNum)) ? Number(moneyNum):0;

		//accAdd 自定义的js 加法 主要用于 小数点计算 
		
		if(opt){
			// 购物车的数量
			dataNum = addBuy(buyBox,dataNum);
			// 侧边的分类 购买数量
			// typeNum = addBuy(typeBox,typeNum);
			// 加减按钮中间的数量
			selNum = addBuy(selBox,selNum);

			delBox.hasClass('show') || delBox.addClass('show');
			selBox.hasClass('show') || selBox.addClass('show');

			eachNum(uid,selNum,true);
			moneyNum = moneyNum.accAdd(money);
		}else if(selNum > 0){
			// 购物车的数量
			dataNum = subBuy(buyBox,dataNum);
			// 侧边的分类 购买数量
			// typeNum = subBuy(typeBox,typeNum);
			// 加减按钮中间的数量
			selNum = subBuy(selBox,selNum);

			if(selNum == 0){
				delBox.removeClass('show');
				selBox.removeClass('show');
			}

			eachNum(uid,selNum,false);
			moneyNum = moneyNum.accSub(money);
		}
		console.log(selNum)
		// jQuery.ajax({
		// 	url: '/path/to/file',
		// 	type: 'post',
		// 	dataType: 'json',
		// 	data: {id:uid,num:selNum},
		// 	success:function(){
		// 	}
		// });
		
		console.log(value)
		moneyBox.text(moneyNum).attr('data-num',moneyNum);

	}

	$('body').on('tap','#su-buy-true',function(){
		// jQuery.ajax({
		// 	url: '/path/to/file',
		// 	type: 'post',
		// 	dataType: 'json',
		// 	data: {value:value},
		// 	success:function(){
		// 		下单成功，跳转
		// 	}
		// });
		location.href = 'buy_pay.html';
	})

})(mui);
</script>
</html>